!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.cpRPA=n()}(this,function(){function t(){}function n(t,n,a,e,o,r,l){var o=o*Math.PI/180;return l||(l=1),r||(r=1),[r*((t-a)*Math.cos(o)-(n-e)*Math.sin(o))+a,l*((t-a)*Math.sin(o)+(n-e)*Math.cos(o))+e]}function a(t,n){return t>n-1?t-n:t<0?n+t:t}function e(t,n,a){var e,o=t[1]-n[1];return!!o&&(!((e=(a-t[1])*(t[0]-n[0])/o+t[0])>t[0]&&e>n[0])&&!(e<t[0]&&e<n[0])&&[e,a])}function o(t){for(var n=[],a=[],e=0;e<t.length;e++)n.push(t[e].lat),a.push(t[e].lng);var o=Math.max.apply(Math,n),r=Math.max.apply(Math,a),l=Math.min.apply(Math,n),u=Math.min.apply(Math,a);return{center:{lat:(o+l)/2,lng:(r+u)/2},latlngs:[{lat:o,lng:u},{lat:o,lng:r},{lat:l,lng:r},{lat:l,lng:u}],northLat:o}}function r(t,a,e){if("function"!=typeof u.latlng2Px&&"function"!=typeof u.px2Latlng)return!1;for(var o,r,l=[],s=u.latlng2Px(a.center),i=0;i<t.length;i++)r=n((o=u.latlng2Px(t[i])).x,o.y,s.x,s.y,e),l.push(u.px2Latlng(r));return l}function l(t,n){var a=t.latlngs[0],e=t.latlngs[3];if("function"!=typeof u.distance)throw new Error('You must call the ".setDistanceFn" method and set a function to calculate the distance!');var o=u.distance({lat:a.lat,lng:a.lng},{lat:e.lat,lng:e.lng}),r=parseInt(o/n/2);return{len:r,lat:(a.lat-e.lat)/r}}var u=new t;return{setOptions:function(t){if(!(t.polygon instanceof Array))throw new Error('cpRPA: the "polygon" of options must be a Array like [{lat:Number,lng:Number}]');if(t.rotate&&"number"!=typeof t.rotate)throw new Error('cpRPA: the "rotate" of options must be a number!');if(t.space&&"number"!=typeof t.space)throw new Error('cpRPA: the "space" of options must be a number!');var n=o(t.polygon),u=r(t.polygon,n,-t.rotate||0);if(!u)throw new Error('cpRPA: You must call ".setLatlng2PxFn" and ".setPx2LatlngFn" methods before setOptions ');for(var s=o(u),i=l(s,t.space||5),f=[],p=[],c=null,h=0;h<i.len;h++){f=[];for(var g=0;g<u.length;g++){var m=a(g+1,u.length);(c=e([u[g].lng,u[g].lat],[u[m].lng,u[m].lat],s.northLat-h*i.lat))&&f.push(c)}f.length<2||f[0][0]!==f[1][0]&&(h%2?p.push({lat:f[0][1],lng:Math.max(f[0][0],f[1][0])},{lat:f[0][1],lng:Math.min(f[0][0],f[1][0])}):p.push({lat:f[0][1],lng:Math.min(f[0][0],f[1][0])},{lat:f[0][1],lng:Math.max(f[0][0],f[1][0])}))}return r(p,n,t.rotate||0)},setDistanceFn:function(n){if("function"!=typeof n)throw new Error("setDistanceFn's argument must be a function");t.prototype.distance=n},setLatlng2PxFn:function(n){if("function"!=typeof n)throw new Error("setLatlng2PxFn's argument must be a function");t.prototype.latlng2Px=n},setPx2LatlngFn:function(n){if("function"!=typeof n)throw new Error("setPx2LatlngFn's argument must be a function");t.prototype.px2Latlng=n}}});